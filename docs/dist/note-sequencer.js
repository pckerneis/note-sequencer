!function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(s,o,function(e){return t[e]}.bind(null,o));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/dist/",i(i.s=4)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t=0,e=0,i=0,s=0){this.x=0,this.y=0,this.width=0,this.height=0,this.x=Math.ceil(t),this.y=Math.ceil(e),this.width=Math.ceil(i),this.height=Math.ceil(s)}removeFromLeft(t){t=Math.floor(Math.max(0,Math.min(t,this.width)));const e=new s(this.x,this.y,t,this.height);return this.x+=t,this.width-=t,e}removeFromTop(t){t=Math.floor(Math.max(0,Math.min(t,this.height)));const e=new s(this.x,this.y,this.width,t);return this.y+=t,this.height-=t,e}removeFromBottom(t){t=Math.floor(Math.max(0,Math.min(t,this.height)));const e=new s(this.x,this.height-t,this.width,t);return this.height-=t,e}}e.ComponentBounds=s;class o{constructor(t=new s){this._bounds=t,this._children=[],this._parent=null,this._visible=!0,this._needRepaint=!0}static boundsIntersect(t,e){return!(e.x>=t.x+t.width||e.x+e.width<=t.x||e.y>=t.y+t.height||e.y+e.height<=t.y)}static createOffscreenCanvas(t,e){const i=document.createElement("canvas");return i.width=t,i.height=e,i}get mouseCursor(){return this._mouseCursor}set mouseCursor(t){this._mouseCursor=t,(this.hovered||this._beingDragged)&&(document.body.style.cursor=this._mouseCursor)}get hovered(){return this._hovered}get width(){return Math.ceil(this._bounds.width)}get height(){return Math.ceil(this._bounds.height)}set rootHolder(t){this._rootHolder=t}getParentComponent(){return this._parent}addAndMakeVisible(t){if(null!=t._parent)throw new Error("A component cannot be added to multiple parents. You first need to remove it from its previous parent");t._visible=!0,this._children.push(t),t._parent=this}removeChild(t){const e=this._children.indexOf(t);e>=0&&(t._visible=!1,t._parent=null,this._children.splice(e,1))}getPosition(){let t=this._bounds.x,e=this._bounds.y,i=this._parent;for(;null!=i;)t+=i._bounds.x,e+=i._bounds.y,i=i._parent;return{x:t,y:e}}getLocalBounds(){return new s(0,0,this.width,this.height)}setBounds(t){this._bounds=t,this.resized()}toFront(){if(null==this._parent)return;const t=this._parent._children.indexOf(this);t<0||(this._parent._children.splice(t,1),this._parent._children.push(this))}hitTest(t){if(!this._visible)return!1;const e=this.getPosition();return!(t.x<e.x||t.x>e.x+this._bounds.width)&&!(t.y<e.y||t.y>e.y+this._bounds.height)}findComponentAt(t){for(let e=this._children.length;--e>=0;){const i=this._children[e];if(i.hitTest(t))return i.findComponentAt(t)}return this}repaint(t=!0){if(this._needRepaint=!0,this._children.forEach(t=>t.repaint(!1)),t){let t=this;for(;null!=t._parent;)t=t._parent;null!=t._rootHolder&&t.paint(t._rootHolder.renderingContext)}}mouseMoved(t){this._beingDragged=t.isDragging&&t.pressedComponent===this}mouseEnter(t){t.isDragging?this._hovered=t.pressedComponent===this:this._hovered=!0,this._hovered&&(document.body.style.cursor=this.mouseCursor)}mouseExit(t){t.isDragging?this._hovered=t.pressedComponent===this:this._hovered=!1}mousePressed(t){}mouseReleased(t){}mouseDragged(t){}clicked(t){}doublePressed(t){}doubleClicked(t){}paint(t){if(this._visible&&this._needRepaint&&Math.floor(this._bounds.width)>0&&Math.floor(this._bounds.height)>0){const e=o.createOffscreenCanvas(Math.ceil(this._bounds.width),Math.ceil(this._bounds.height));this.render(e.getContext("2d")),t.drawImage(e,Math.floor(this._bounds.x),Math.floor(this._bounds.y))}this._children.forEach(e=>e.paint(t)),this._needRepaint=!1}}e.Component=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(5),o=i(6),n=i(15),r=i(16);e.MIN_SEMI_H=4,e.MAX_SEMI_H=30,e.PITCH_PATTERN=[0,1,0,1,0,0,1,0,1,0,1,0],e.MIN_PITCH=0,e.MAX_PITCH=127,e.MAX_VELOCITY=127;const l={background:"#ffffff",backgroundAlternate:"#0000000f",backgroundBlackKey:"#00000017",strokeLight:"#00000020",strokeDark:"#00000050",text:"#000000",velocityHandle:"#ff1906",velocityHandleSelected:"#00a8ff",whiteKey:"#ffffff",blackKey:"#5e5e5e",noteHigh:"#ff1906",noteLowBlend:"#d2c263",noteOutline:"#60606090",noteOutlineSelected:"#00a8ff",draggableBorder:"#8f8f8f",draggableBorderHover:"#676767",lassoBackground:"#00a8ff20",lassoOutline:"#00a8ff80"};class h extends n.CustomElement{constructor(){super(),this._model={velocityTrackHeight:-.3,verticalRange:{start:60,end:72},visibleTimeRange:{start:0,end:16},maxTimeRange:{start:0,end:16},signature:{upper:4,lower:4},zoomSensitivity:30,adaptiveMode:!0,colors:l,theme:new r.LookAndFeel_Default},this._shadowRoot=this.attachShadow({mode:"closed"}),this._sequencerRoot=new o.SequencerRoot(this._model),this._rootHolder=new s.RootComponentHolder(100,100,this._sequencerRoot),this._shadowRoot.append(this._rootHolder.canvas);const t=document.createElement("style");t.innerHTML=a,this._shadowRoot.append(t),new ResizeObserver(()=>this.resizeAndDraw()).observe(this),new MutationObserver(()=>{this.styleChanged()}).observe(this,{attributes:!0}),Object.keys(this._model.colors).forEach(t=>{this.registerCustomColor(t,this._model.colors[t])})}static get tag(){return"note-sequencer"}static get observedAttributes(){return[h.TIME_START,"duration","pitch-start","pitch-end"]}get colors(){return this._model.colors}get timeStart(){return this._model.maxTimeRange.start}set timeStart(t){let e=Number(t);if(isNaN(e))throw new Error("Unhandled type error when setting timeStart");e=this._sequencerRoot.setTimeStart(e),this.setAttribute(h.TIME_START,e.toString())}get duration(){return this._model.maxTimeRange.start+this._model.maxTimeRange.end}set duration(t){let e=Number(t);if(isNaN(e))throw new Error("Unhandled type error when setting duration");e=this._sequencerRoot.setDuration(e),this.setAttribute(h.DURATION,e.toString())}get theme(){return this._model.theme.name}set theme(t){switch(t){case"live":this._model.theme=new r.LookAndFeel_Live;break;case"default":default:this._model.theme=new r.LookAndFeel_Default,t="default"}this.setAttribute(h.THEME,t),this.draw()}connectedCallback(){this._rootHolder.attachMouseEventListeners(),this.timeStart=this.timeStart||0,this.duration=this.duration||16,this.resizeAndDraw()}disconnectedCallback(){this._rootHolder.removeMouseEventListeners()}attributeChangedCallback(){this.draw()}draw(){this._rootHolder.repaint()}styleChanged(){super.styleChanged(),this.customColors.forEach(t=>{this._model.colors[t.name]=t.value}),this.draw()}resizeAndDraw(){const t=this.getBoundingClientRect();this._rootHolder.resize(Math.ceil(t.width),Math.ceil(t.height)),this.draw()}}e.NoteSequencer=h,h.TIME_START="time-start",h.DURATION="duration",h.THEME="theme";const a="\n:host {\n  position: relative;\n  min-width: 200px;\n  min-height: 200px;\n  width: 100%;\n  height: 100%;\n  display: inline-block;\n}\n\ncanvas {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n}\n"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.squaredDistance=function(t,e,i,s){return(i-t)*(i-t)+(s-e)*(s-e)},e.getBackgroundAlternateWidth=function(t,e){let i=16*e.upper/e.lower;if(i*t>200)for(i/=e.upper;i*t>200;)i/=2;else for(;i*t<100;)i*=2;return i}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.LassoSelector=class{constructor(t,e,i){this.ownerComp=t,this.selectedItemSet=e,this.colors=i}beginLasso(t){const e=this.ownerComp.getPosition();this.lasso={startX:t.position.x-e.x,startY:t.position.y-e.y,endX:t.position.x-e.x,endY:t.position.y-e.y,commuteMode:t.modifiers.shift,commutableSelection:[]},t.modifiers.shift&&(this.lasso.commutableSelection=this.selectedItemSet.getItems())}endLasso(){this.lasso=null}dragLasso(t){if(null==this.lasso)return;const e=this.ownerComp.getPosition();this.lasso.endX=t.position.x-e.x,this.lasso.endY=t.position.y-e.y;const i={x:Math.min(this.lasso.startX,this.lasso.endX),y:Math.min(this.lasso.startY,this.lasso.endY),width:Math.abs(this.lasso.startX-this.lasso.endX),height:Math.abs(this.lasso.startY-this.lasso.endY)};let s;if("function"==typeof this.findAllElementsInLasso&&(s=this.findAllElementsInLasso(i)),null!=s)if(this.lasso.commuteMode){this.selectedItemSet.deselectAll();for(let t of this.lasso.commutableSelection)this.selectedItemSet.addToSelection(t);for(let t of s)this.selectedItemSet.getItems().indexOf(t)>=0?this.selectedItemSet.removeFromSelection(t):this.selectedItemSet.addToSelection(t)}else{this.selectedItemSet.deselectAll();for(let t of s)this.selectedItemSet.addToSelection(t)}}drawLasso(t){if(null==this.lasso)return;t.fillStyle=this.colors.lassoBackground,t.strokeStyle=this.colors.lassoOutline,t.lineWidth=2;const e=Math.min(this.lasso.startX,this.lasso.endX),i=Math.min(this.lasso.startY,this.lasso.endY),s=Math.max(this.lasso.startX,this.lasso.endX)-e,o=Math.max(this.lasso.startY,this.lasso.endY)-i;t.fillRect(e,i,s,o),t.strokeRect(e,i,s,o)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1);null==customElements.get(s.NoteSequencer.tag)&&customElements.define(s.NoteSequencer.tag,s.NoteSequencer)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),o=i(2);function n(t){return{shift:t.shiftKey,option:t.ctrlKey}}e.RootComponentHolder=class{constructor(t,e,i){this.width=t,this.height=e,this.rootComponent=i,i.rootHolder=this,this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e,this.initMouseEventListeners()}get renderingContext(){return this.canvas.getContext("2d")}repaint(){this.rootComponent.repaint()}resize(t,e){this.canvas.width=t,this.canvas.height=e,this.rootComponent.setBounds(new s.ComponentBounds(0,0,t,e))}initMouseEventListeners(){let t,e,i,s,r,l,h=null,a=null,d=0,c=0,m=!1,u=!1;const g=t=>{const e=this.canvas.getBoundingClientRect();return{x:t.clientX-e.x,y:t.clientY-e.y}},f=(t,e)=>{const i=g(t),s=this.rootComponent.findComponentAt(i);null!=s&&e(s)};this.canvasMouseDownListener=e=>f(e,s=>{h=s,t=g(e),i=performance.now(),m=!1,u=!0,s.mousePressed({position:t,positionAtMouseDown:t,pressedComponent:s,wasDragged:m,modifiers:n(e),isDragging:u}),null==l||null==r||i>r+400||o.squaredDistance(l.x,l.y,t.x,t.y)>30?c=1:c++,2==c&&(s.doublePressed({position:t,positionAtMouseDown:t,pressedComponent:s,wasDragged:m,modifiers:n(e),isDragging:u}),c=0)}),this.documentMouseUpListener=o=>{e=g(o),s=performance.now(),null!=h&&(h.mouseReleased({position:e,positionAtMouseDown:t,pressedComponent:h,wasDragged:m,modifiers:n(o),isDragging:u}),s<i+200&&!m&&(l=e,h.clicked({position:e,positionAtMouseDown:t,pressedComponent:h,wasDragged:m,modifiers:n(o),isDragging:u}),null==r||s>r+500?d=1:d++,2!=d||m||(h.doubleClicked({position:e,positionAtMouseDown:t,pressedComponent:h,wasDragged:m,modifiers:n(o),isDragging:u}),d=0)),h=null,r=performance.now()),m=!1,u=!1},this.documentMouseMoveListener=e=>{const{x:i,y:s}=g(e);!m&&null!=t&&o.squaredDistance(t.x,t.y,i,s)>30&&(m=!0),f(e,o=>{if(document.body.style.cursor=o.mouseCursor||"default",null!=a&&a!=o){const r={position:{x:i,y:s},positionAtMouseDown:t,wasDragged:m,modifiers:n(e),pressedComponent:h,isDragging:u};a.mouseExit(Object.assign({},r)),o.mouseEnter(Object.assign({},r))}a=o,o.mouseMoved({position:{x:i,y:s},positionAtMouseDown:t,pressedComponent:o,wasDragged:m,modifiers:n(e),isDragging:u})}),e.buttons>0&&null!=h&&(document.body.style.cursor=h.mouseCursor,h.mouseDragged({position:{x:i,y:s},positionAtMouseDown:t,pressedComponent:h,wasDragged:m,modifiers:n(e),isDragging:u}))}}attachMouseEventListeners(){this.canvas.addEventListener("mousedown",this.canvasMouseDownListener),document.addEventListener("mouseup",this.documentMouseUpListener),document.addEventListener("mousemove",this.documentMouseMoveListener)}removeMouseEventListeners(){this.canvas.removeEventListener("mousedown",this.canvasMouseDownListener),document.removeEventListener("mouseup",this.documentMouseUpListener),document.removeEventListener("mousemove",this.documentMouseMoveListener)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),o=i(7),n=i(8),r=i(10),l=i(11),h=i(13),a=i(14);class d extends s.Component{constructor(t){super(),this.model=t,this._grid=new n.NoteGridComponent(t),this.addAndMakeVisible(this._grid),this._pitchRuler=new r.PitchRuler(t,this._grid),this.addAndMakeVisible(this._pitchRuler),this._timeRuler=new l.TimeRuler(t,this._grid),this.addAndMakeVisible(this._timeRuler),this._velocityRuler=new h.VelocityRuler(t),this.addAndMakeVisible(this._velocityRuler),this._draggableBorder=new o.DraggableBorder(t,this),this.addAndMakeVisible(this._draggableBorder),this._velocityTrack=new a.VelocityTrack(t,this._grid),this.addAndMakeVisible(this._velocityTrack)}resized(){null==this.model.velocityTrackHeight?this.draggableBorderPosition=this.height-80:this.model.velocityTrackHeight<0&&(this.draggableBorderPosition=this.height*(1+this.model.velocityTrackHeight));const t=this.height-this.draggableBorderPosition,e=this.getLocalBounds(),i=e.removeFromBottom(t);this._velocityRuler.setBounds(i.removeFromLeft(40)),this._velocityTrack.setBounds(i),this._draggableBorder.setBounds(e.removeFromBottom(4));const s=e.removeFromTop(40);s.removeFromLeft(40),this._timeRuler.setBounds(s),this._pitchRuler.setBounds(e.removeFromLeft(40)),this._grid.setBounds(e),this.repaint()}render(t){t.fillStyle=this.model.colors.background,t.fillRect(0,0,this.width,this.height)}borderDragged(t){this.draggableBorderPosition=Math.max(80,Math.min(t-this.getPosition().y,this.height));this.draggableBorderPosition>this.height-50&&(this.draggableBorderPosition=this.draggableBorderPosition>this.height-25?this.height:this.height-50),this.model.velocityTrackHeight=this.height-this.draggableBorderPosition,this.resized()}setTimeStart(t){const e=Math.max(0,t),i=e-this.model.maxTimeRange.start;if(0===i)return 0;this.model.maxTimeRange.start+=i,this.model.maxTimeRange.end+=i;const s=this.model.maxTimeRange.start-this.model.visibleTimeRange.start;s>0&&(this.model.visibleTimeRange.start+=s,this.model.visibleTimeRange.end+=s);const o=this.model.maxTimeRange.end-this.model.visibleTimeRange.end;return o<0&&(this.model.visibleTimeRange.start+=o,this.model.visibleTimeRange.end+=o),this.repaint(),e}setDuration(t){return t=Math.max(0,t),this.model.maxTimeRange.end=this.model.maxTimeRange.start+t,this.model.visibleTimeRange.end=Math.min(this.model.visibleTimeRange.end,this.model.maxTimeRange.end),this.repaint(),t}}e.SequencerRoot=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);class o extends s.Component{constructor(t,e){super(),this.model=t,this.owner=e,this.mouseCursor="ns-resize"}mousePressed(t){this.initialPosition=t.position.y}mouseDragged(t){const e=this.initialPosition+(t.position.y-t.positionAtMouseDown.y);this.owner.borderDragged(e)}mouseEnter(t){super.mouseEnter(t),this.repaint()}mouseExit(t){super.mouseExit(t),this.repaint()}render(t){t.fillStyle=this.hovered?this.model.colors.draggableBorderHover:this.model.colors.draggableBorder,t.fillRect(0,0,this.width,this.height)}resized(){}}e.DraggableBorder=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1),o=i(0),n=i(3),r=i(9);class l extends o.Component{constructor(t){super(),this.model=t,this.adaptiveLabels=["XL","X","M","S","XS"],this.adaptiveRatios=[1,.5,.25,.1,.05],this.adaptiveIndex=3,this.fixedIncrements=[128,64,32,16,8,4,2,1,.5],this.fixedIndex=5,this._notes=[],this._mouseDownResult=!1,this._currentVelocity=s.MAX_VELOCITY,this._initialDuration=null,this._initialStart=null,this._initialVelocity=null,this._initialPosition=null,this._minStartOffset=null,this._maxDurationOffset=null,this._minDragOffset=null,this._maxDragOffset=null,this._selectedSet=new r.SelectedItemSet,this._lasso=new n.LassoSelector(this,this._selectedSet,this.model.colors),this._lasso.findAllElementsInLasso=t=>this._notes.filter(e=>{const i={x:this.getPositionForTime(e.time),y:this.getPositionForPitch(e.pitch),width:Math.max(2,e.duration*this.getSixteenthWidth()),height:this.getSemitoneHeight()};return o.Component.boundsIntersect(i,t)})}get notes(){return this._notes}get selectedSet(){return this._selectedSet}render(t){t.fillStyle=this.model.colors.background,t.fillRect(0,0,this.width,this.height);const e=this.model.visibleTimeRange.start,i=this.model.visibleTimeRange.end,o=this.getSixteenthWidth();this.drawHorizontalBackground(t,o,e,i);const n=this.model.verticalRange.start,r=this.model.verticalRange.end,l=this.getSemitoneHeight();l>s.MIN_SEMI_H?this.model.theme.drawSemiTonePattern(t,this.width,this.height,n,r,l,this.model.colors):this.model.theme.drawOctaveLines(t,this.width,this.height,n,r,l,this.model.colors),this._lasso.drawLasso(t),this.drawNotes(t,l,o)}resized(){this.repaint()}removeNote(t,e=!0){this._selectedSet.removeFromSelection(t),this._notes=this._notes.filter(e=>e!==t),e&&this.getParentComponent().repaint()}moveNoteToFront(t){const e=this._notes.indexOf(t);e>=0&&(this._notes.splice(e,1),this._notes.push(t),this.getParentComponent().repaint())}deleteSelection(){const t=this._selectedSet.getItems();for(let e=t.length;--e>=0;)this.removeNote(t[e],!1);this.getParentComponent().repaint()}getSixteenthWidth(){return this.width/(this.model.visibleTimeRange.end-this.model.visibleTimeRange.start)}getTimeAt(t){const e=this.model.visibleTimeRange.start,i=this.getSixteenthWidth();return t-=this.getPosition().x,(t+=e*i)/i}getPitchAt(t){const e=this.model.verticalRange.start,i=this.getSemitoneHeight();return t-=this.getPosition().y,t-=e*i,t=this.height-t,t+=.5*i,Math.round(t/i)}getPositionForTime(t){const e=this.model.visibleTimeRange.start,i=this.model.visibleTimeRange.end-e;return(t-e)*(this.width/i)}getPositionForPitch(t){const e=this.getSemitoneHeight();return this.height-(t-this.model.verticalRange.start)*e}getSemitoneHeight(){return this.height/(this.model.verticalRange.end-this.model.verticalRange.start)}doublePressed(t){const e=this.getPosition(),i={x:t.position.x-e.x,y:t.position.y-e.y},s=this.findNoteAt(i);if(null!=s)return void this.removeNote(s);const o=this.snapToGrid(this.getTimeAt(t.position.x)),n={time:o,pitch:Math.round(this.getPitchAt(t.position.y)),duration:this.getTimeIncrement(),velocity:this._currentVelocity,hidden:!1,selected:!0,tempDuration:0,initialStart:o,initialVelocity:this._currentVelocity};this._notes.push(n),this._selectedSet.setUniqueSelection(n),this.removeOverlaps(!0),this._dragAction="V_RIGHT",this._draggedItem=n,this.getParentComponent().repaint(),this.mouseCursor="w-resize"}mouseMoved(t){if(super.mouseMoved(t),t.isDragging)return;const e=this.getPosition(),i={x:t.position.x-e.x,y:t.position.y-e.y},s=this.findNoteAt(i);if(null==s)return void(this.mouseCursor="default");const o=this.getDragActionForNoteAt(i,s);this.mouseCursor="MOVE_NOTE"==o?"move":"LEFT"==o?"w-resize":"RIGHT"==o?"e-resize":"default"}mousePressed(t){const e=this.getPosition(),i={x:t.position.x-e.x,y:t.position.y-e.y},s=this.findNoteAt(i);if(null==s)return t.modifiers.shift||this._selectedSet.deselectAll(),this._lasso.beginLasso(t),void(this._mouseDownResult=!0);this._mouseDownResult=this._selectedSet.addToSelectionMouseDown(s,t.modifiers.shift),this._dragAction=this.getDragActionForNoteAt(i,s),this.setMouseCursor(this._dragAction),this._draggedItem=s,this.moveNoteToFront(s)}mouseReleased(t){this._dragAction="NONE",this.setMouseCursor(this._dragAction),this._initialPosition=null,this._initialDuration=null,this._initialStart=null,this._initialVelocity=null,this._lasso.endLasso();for(const t of this._selectedSet.getItems())t.duration=Math.max(0,t.duration);this._selectedSet.addToSelectionMouseUp(t.wasDragged,t.modifiers.shift,this._mouseDownResult),this.removeOverlaps(!0),this._notes.forEach(t=>{t.initialVelocity=t.velocity}),this._draggedItem=null}mouseDragged(t){"NONE"==this._dragAction&&this._lasso.dragLasso(t),t.wasDragged&&"NONE"!=this._dragAction?("MOVE_NOTE"==this._dragAction?this.moveSelection(t):"RIGHT"==this._dragAction||"V_RIGHT"==this._dragAction?this.dragEndPoints(t):"LEFT"==this._dragAction&&this.dragStartPoints(t),"V_RIGHT"==this._dragAction&&this.dragVelocity(t),this.removeOverlaps(!1),this.getParentComponent().repaint()):this.getParentComponent().repaint()}getTimeAsMBS(t){const e=16/this.model.signature.lower;let i=Math.floor(t/e);const s=t-i*e,o=Math.floor(i/this.model.signature.upper);return i-=o*this.model.signature.upper,[o,i,s]}getStringForTime(t,e){const i=this.getTimeAsMBS(t);let s=i[0],o=i[1],n=i[2];e&&(s++,o++,n++);const r=1!=n;return s+(r||1!=o?"."+o:"")+(r?"."+Math.floor(n):"")}getTimeIncrement(){const t=this.getSixteenthWidth();let e;if(t<1e-5)return null;if(this.model.adaptiveMode){const i=this.adaptiveRatios[this.adaptiveIndex]*this.width;if(e=16*this.model.signature.upper/this.model.signature.lower,e*t>i)for(e/=this.model.signature.upper;t*e>i;)e/=2;else for(;t*e*2<i;)e*=2}else e=this.fixedIncrements[this.fixedIndex];return e}moveSelection(t){if(null==this._draggedItem||0==this._selectedSet.getItems().length)return;const e={time:this._draggedItem.time,pitch:this._draggedItem.pitch};if(null==this._initialPosition){this._initialPosition=e;let t=1/0,i=-1/0,o=1/0,n=-1/0;this._selectedSet.getItems().forEach(e=>{(null==t||e.time<t)&&(t=e.time),(null==i||e.time+e.duration>i)&&(i=e.time+e.duration),(null==o||e.pitch-1<o)&&(o=e.pitch-1),(null==n||e.pitch>n)&&(n=e.pitch)}),this._minDragOffset={time:-t,pitch:-o},this._maxDragOffset={time:this.model.maxTimeRange.end-i,pitch:s.MAX_PITCH-n}}const i=t.position.x-t.positionAtMouseDown.x,o=t.position.y-t.positionAtMouseDown.y,n=Math.max(this._minDragOffset.time,Math.min(i/this.getSixteenthWidth(),this._maxDragOffset.time)),r=Math.max(this._minDragOffset.pitch,Math.min(-o/this.getSemitoneHeight(),this._maxDragOffset.pitch));this._draggedItem.pitch=Math.round(this._initialPosition.pitch+r),this._draggedItem.time=this._initialPosition.time+n,t.modifiers.option||(this._draggedItem.time=this.snapToGrid(this._draggedItem.time));const l=this._draggedItem.time-e.time,h=this._draggedItem.pitch-e.pitch;for(const t of this._selectedSet.getItems())t!==this._draggedItem&&(t.pitch+=h,t.time+=l)}dragEndPoints(t){if(null===this._draggedItem)return;const e=this._draggedItem.duration;if(null==this._initialDuration){this._initialDuration=e;let t=null;this._selectedSet.getItems().forEach(e=>{(null==t||e.time+e.duration>t)&&(t=e.time+e.duration)}),this._maxDurationOffset=this.model.maxTimeRange.end-t}const i=t.position.x-t.positionAtMouseDown.x,s=Math.min(this._maxDurationOffset,i/this.getSixteenthWidth());if(this._draggedItem.duration=this._initialDuration+s,!t.modifiers.option){const t=this.snapToGrid(this._draggedItem.time+this._draggedItem.duration);this._draggedItem.duration=t-this._draggedItem.time,this._draggedItem.duration=Math.max(0,this._draggedItem.duration)}const o=this._draggedItem.duration-e;for(const t of this._selectedSet.getItems())t!==this._draggedItem&&(t.duration+=o)}dragStartPoints(t){if(null==this._draggedItem)return;const e=this._draggedItem.time,i=this._draggedItem.duration;if(null===this._initialStart){this._initialStart=e,this._initialDuration=i;for(const t of this._selectedSet.getItems())t.initialStart=t.time;let t=null;this._selectedSet.getItems().forEach(e=>{(null==t||e.time<t)&&(t=e.time)}),this._minStartOffset=-t}const s=t.position.x-t.positionAtMouseDown.x,o=Math.max(this._minStartOffset,s/this.getSixteenthWidth()),n=this._draggedItem.time+this._draggedItem.duration;this._draggedItem.time=Math.min(n,this._initialStart+o),this._draggedItem.duration=Math.max(0,this._initialDuration-o),!t.modifiers.option&&this._draggedItem.duration>0&&(this._draggedItem.time=this.snapToGrid(this._draggedItem.time),this._draggedItem.duration=Math.max(0,this._initialDuration-(this._draggedItem.time-this._initialStart)));const r=this._draggedItem.time-this._initialStart;for(const t of this._selectedSet.getItems()){if(t===this._draggedItem)continue;const e=t.time+t.duration;t.time=t.initialStart+r,t.time=Math.min(t.time,e),t.duration=Math.max(0,e-t.time)}}dragVelocity(t){if(null==this._draggedItem)return;null==this._initialVelocity&&(this._initialVelocity=this._draggedItem.velocity);const e=t.position.y-t.positionAtMouseDown.y;this._draggedItem.velocity=this._initialVelocity-e,this._draggedItem.velocity=Math.max(0,Math.min(this._draggedItem.velocity,127)),this._currentVelocity=this._draggedItem.velocity}drawHorizontalBackground(t,e,i,s){const o=this.getTimeIncrement();o<=0||this.model.theme.drawTimeBackground(t,this.height,e,o,i,s,this.model.signature,this.model.colors)}drawNotes(t,e,i){for(const s of this._notes){if(s.hidden)continue;const o=this.getPositionForTime(s.time),n=this.getPositionForPitch(s.pitch),r=Math.max(0,null!=s.tempDuration?s.tempDuration*i:s.duration*i);this.model.theme.drawNote(t,o,n,r,e,s.velocity,s.selected,this.model.colors)}}removeOverlaps(t){for(const t of this._notes)t.tempDuration=null,t.hidden=null;for(const e of this._selectedSet.getItems())for(const i of this._notes)e!=i&&e.pitch==i.pitch&&(e.time<=i.time?i.time<e.time+e.duration&&(i.selected||(t?this.removeNote(i):i.hidden=!0)):e.time<i.time+i.duration&&(t?i.duration=e.time-i.time:i.tempDuration=Math.max(0,e.time-i.time)));this.getParentComponent().repaint()}getDragActionForNoteAt(t,e){const i=this.getPositionForTime(e.time),s=Math.max(2,e.duration*this.getSixteenthWidth()),o=t.x-i;return o>s?"NONE":o>=s-3?"RIGHT":o>=3?"MOVE_NOTE":o>=0?"LEFT":"NONE"}findNoteAt(t){for(const e of this.notes){const i=this.getPositionForTime(e.time),s=this.getPositionForPitch(e.pitch),o=Math.max(2,e.duration*this.getSixteenthWidth()),n=this.getSemitoneHeight();if(t.x>=i&&t.x<=i+o&&t.y>=s&&t.y<=s+n)return e}return null}snapToGrid(t){const e=this.getTimeIncrement();return e>0?e*Math.floor(t/e):t*this.getSixteenthWidth()}setMouseCursor(t){switch(t){case"MOVE_NOTE":this.mouseCursor="move";break;case"LEFT":this.mouseCursor="w-resize";break;case"RIGHT":this.mouseCursor="e-resize";break;default:this.mouseCursor="default"}}}e.NoteGridComponent=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.SelectedItemSet=class{constructor(){this._selection=[],this._itemAboutToBeSelected=null,this.onchange=()=>{}}getItems(){return this._selection}addToSelection(t,e=!1){e&&this.deselectAll(),this._selection.push(t),t.selected=!0}addToSelectionMouseDown(t,e){return this._selection.includes(t)?!!e&&(this.removeFromSelection(t),!0):(e||this.deselectAll(),this.doAddToSelection(t,!0),!0)}addToSelectionMouseUp(t,e,i){null==this._itemAboutToBeSelected||t||i||this._selection.includes(this._itemAboutToBeSelected)||(e||this.deselectAll(),this.doAddToSelection(this._itemAboutToBeSelected,!0),this._itemAboutToBeSelected=null)}setUniqueSelection(t){this.deselectAll(),this.doAddToSelection(t,!0)}removeFromSelection(t){this._selection=this._selection.filter(e=>e!==t),t.selected=!1,this.onchange()}deselectAll(){this._selection.forEach(t=>t.selected=!1),this._selection=[],this.onchange()}doAddToSelection(t,e){this._selection.push(t),t.selected=!0,e&&this.onchange()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1),o=i(0);class n extends o.Component{constructor(t,e){super(),this.model=t,this.grid=e,this.dragStarted=!1,this.currentlyTranslating=!1,this.currentlyZooming=!1,this.consecutiveHorizontalDrag=0,this.consecutiveVerticalDrag=0,this.isPreviewingNote=!1,this.lastPreviewedPitch=null,this.hoveredPitch=null}mousePressed(t){const e=this.grid.getSemitoneHeight(),i=this.getPosition();this.model.theme.isOnPianoRoll(t.position.x-i.x,t.position.y-i.y,this.width,this.height,e)?this.previewNoteAt(t.position.y):this.dragStarted=!0,this.lastMouseX=t.position.x,this.lastMouseY=t.position.y}mouseDragged(t){const e=this.getPosition(),i=this.grid.getSemitoneHeight();if(this.dragStarted){const e=t.position.y-this.lastMouseY,i=t.position.x-this.lastMouseX;this.lastMouseY=t.position.y,this.lastMouseX=t.position.x,this.shouldTranslate(i,e)?this.translate(e):i>0?this.zoomIn():this.zoomOut()}else this.model.theme.isOnPianoRoll(t.position.x-e.x,t.position.y-e.y,this.width,this.height,i)&&this.previewNoteAt(t.position.y)}mouseReleased(){this.currentlyTranslating=!1,this.currentlyZooming=!1,this.dragStarted=!1,this.consecutiveHorizontalDrag=0,this.consecutiveVerticalDrag=0,this.isPreviewingNote&&(this.isPreviewingNote=!1)}doubleClicked(t){const e=this.getPosition();this.model.theme.isOnPianoRoll(t.position.x-e.x,t.position.y-e.y,this.width,this.height,this.grid.getSemitoneHeight())||(this.model.verticalRange.start=s.MIN_PITCH,this.model.verticalRange.end=s.MAX_PITCH,this.getParentComponent().repaint())}resized(){}render(t){const e=this.getLocalBounds();t.fillStyle=this.model.colors.background,t.fillRect(0,0,this.width,this.height);const i=this.model.verticalRange.start,s=this.model.verticalRange.end,o=this.grid.getSemitoneHeight();this.model.theme.drawPitchRuler(t,this.width,this.height,i,s,o,this.hoveredPitch,this.model.colors),t.fillStyle=this.model.colors.strokeDark,t.fillRect(e.width-1,0,1,e.height)}previewNoteAt(t){const e=this.grid.getPitchAt(t);e!=this.lastPreviewedPitch&&(this.isPreviewingNote=!0,this.lastPreviewedPitch=e)}zoomIn(){const t=this.model.verticalRange.end-this.model.verticalRange.start;if(this.grid.getSemitoneHeight()<s.MAX_SEMI_H){const e=t/this.model.zoomSensitivity;this.model.verticalRange.start+=e,this.model.verticalRange.end-=e,this.getParentComponent().repaint()}}zoomOut(){const t=this.model.verticalRange.start,e=(this.model.verticalRange.end-t)/this.model.zoomSensitivity;this.model.verticalRange.start-=e,this.model.verticalRange.end+=e,this.model.verticalRange.end=Math.min(this.model.verticalRange.end,s.MAX_PITCH),this.model.verticalRange.start=Math.max(this.model.verticalRange.start,s.MIN_PITCH),this.getParentComponent().repaint()}translate(t){const e=this.model.verticalRange.start,i=this.model.verticalRange.end,o=this.grid.getSemitoneHeight();if(t<0){const i=e+t/o,n=Math.max(i,s.MIN_PITCH),r=n-i+t/o;this.model.verticalRange.start=n,this.model.verticalRange.end+=r,this.getParentComponent().repaint()}else if(t>0){const e=i+t/o,n=Math.min(e,s.MAX_PITCH),r=n-e+t/o;this.model.verticalRange.end=n,this.model.verticalRange.start+=r,this.getParentComponent().repaint()}}shouldTranslate(t,e){if(Math.abs(t)>Math.abs(e)?(this.consecutiveHorizontalDrag++,this.consecutiveVerticalDrag=0):Math.abs(e)>Math.abs(t)&&(this.consecutiveVerticalDrag++,this.consecutiveHorizontalDrag=0),this.currentlyTranslating){const i=Math.abs(t)>Math.abs(8+e)||this.consecutiveHorizontalDrag>5;return this.currentlyTranslating=!i,this.currentlyZooming=i,!i}if(this.currentlyZooming){const i=Math.abs(e)>Math.abs(8+t)||this.consecutiveVerticalDrag>5;return this.currentlyTranslating=i,this.currentlyZooming=!i,i}{const i=Math.abs(e)>Math.abs(t);return this.currentlyTranslating=i,this.currentlyZooming=!i,i}}}e.PitchRuler=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(12),o=i(0);class n extends o.Component{constructor(t,e){super(),this.model=t,this.grid=e}mousePressed(t){this.timeAtMouseDown=this.grid.getTimeAt(t.position.x),this.rangeAtMouseDown=Object.assign({},this.model.visibleTimeRange),this.zoomAtMouseDown=(this.model.maxTimeRange.end-this.model.maxTimeRange.start)/(this.model.visibleTimeRange.end-this.model.visibleTimeRange.start)}doubleClicked(t){this.model.visibleTimeRange.start=0,this.model.visibleTimeRange.end=this.model.maxTimeRange.end,this.getParentComponent().repaint()}mouseDragged(t){const e=t.positionAtMouseDown.y-t.position.y,i=(this.model.maxTimeRange.end-this.model.maxTimeRange.start)*e*-.0015/2;let o=this.rangeAtMouseDown.start+i,n=this.rangeAtMouseDown.end-i;const r=Math.max(0,1-(n-o));o-=.5*r,n+=.5*r,this.model.visibleTimeRange.start=Math.max(this.model.maxTimeRange.start,o),this.model.visibleTimeRange.end=Math.min(this.model.maxTimeRange.end,n);let l=this.timeAtMouseDown-this.grid.getTimeAt(t.position.x);const h=this.model.maxTimeRange.start-this.model.visibleTimeRange.start,a=this.model.visibleTimeRange.end-this.model.maxTimeRange.end;l=s.clamp(l,h,-a),this.model.visibleTimeRange.start=Math.max(this.model.maxTimeRange.start,o+l),this.model.visibleTimeRange.end=Math.min(this.model.maxTimeRange.end,n+l),this.getParentComponent().repaint()}resized(){}render(t){const e=this.getLocalBounds();t.fillStyle=this.model.colors.background,t.fillRect(0,0,this.width,this.height);const i=this.model.visibleTimeRange.start,s=this.model.visibleTimeRange.end,o=this.grid.getSixteenthWidth();if(o<1e-4||o===1/0)return;let n=1;for(;o*n<50;)n*=2;let r=1;if(o*r<5)for(;o*r<5;)r*=2;else for(;o*r*.5>5;)r*=.5;for(let l=0;l<Math.ceil(s);l+=r){const s=(l-i)*o;if(s<0)continue;const h=l%(4*r)==0?.4:.12;if(t.fillStyle=this.model.colors.strokeLight,t.fillRect(s,e.height*(1-h),1,e.height*h),l%n==0){t.rect(s+1,e.height*(1-h),1,1),t.fillStyle=this.model.colors.text;const i=this.grid.getStringForTime(l,!0);t.fillText(i,s+4,e.height-5,50)}}t.fillStyle=this.model.colors.strokeDark,t.fillRect(0,e.height-1,e.width,1)}}e.TimeRuler=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.clamp=function(t,e,i){const s=Math.min(e,i),o=Math.max(e,i);return Math.min(Math.max(s,t),o)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);class o extends s.Component{constructor(t){super(),this.model=t}render(t){t.fillStyle=this.model.colors.background,t.fillRect(0,0,this.width,this.height),this.model.theme.drawVelocityRuler(t,this.width,this.height,this.model.colors)}resized(){}}e.VelocityRuler=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1),o=i(0),n=i(3),r=i(2);class l extends o.Component{constructor(t,e){super(),this.model=t,this.grid=e,this.handleRadius=3,this.lasso=new n.LassoSelector(this,this.grid.selectedSet,this.model.colors),this.lasso.findAllElementsInLasso=t=>{const e=this.height/s.MAX_PITCH;return this.grid.notes.filter(i=>{const s={x:this.grid.getPositionForTime(i.time)-this.handleRadius,y:this.height-i.velocity*e-this.handleRadius,width:2*this.handleRadius,height:2*this.handleRadius};return o.Component.boundsIntersect(s,t)})}}mousePressed(t){const e=this.getPosition(),i={x:t.position.x-e.x,y:t.position.y-e.y};this._draggingHandle=!1;const s=this.findHandleAt(i);if(null==s)return t.modifiers.shift||this.grid.selectedSet.deselectAll(),this.lasso.beginLasso(t),void(this._mouseDownResult=!0);this._initialVelocity=s.velocity,this.grid.selectedSet.getItems().forEach(t=>{t.initialVelocity=t.velocity}),this.grid.moveNoteToFront(s),this._draggingHandle=!0,this._mouseDownResult=this.grid.selectedSet.addToSelectionMouseDown(s,t.modifiers.shift)}mouseDragged(t){t.wasDragged&&(this._draggingHandle?this.dragSelectedHandles(t):this.lasso.dragLasso(t),this.getParentComponent().repaint())}mouseReleased(t){this.lasso.endLasso(),this.grid.selectedSet.addToSelectionMouseUp(t.wasDragged,t.modifiers.shift,this._mouseDownResult),this.grid.notes.forEach(t=>{t.initialVelocity=t.velocity}),this.getParentComponent().repaint()}render(t){t.fillStyle=this.model.colors.background,t.fillRect(0,0,this.width,this.height);const e=this.model.visibleTimeRange.start,i=this.model.visibleTimeRange.end,s=this.grid.getSixteenthWidth();this.drawHorizontalBackground(t,s,e,i),this.lasso.drawLasso(t),this.drawVelocityHandles(t)}resized(){}drawHorizontalBackground(t,e,i,s){const o=this.grid.getTimeIncrement();o<=0||this.model.theme.drawTimeBackground(t,this.height,e,o,i,s,this.model.signature,this.model.colors)}drawVelocityHandles(t){const e=this.height/s.MAX_PITCH,i=this.grid.getSixteenthWidth();for(const s of this.grid.notes){const o=this.grid.getPositionForTime(s.time);console.log(s.duration);const n=Math.max(0,i*(s.tempDuration||s.duration));console.log(o,n),o+n<-5||o>this.width+5||this.model.theme.drawVelocityHandle(t,o,s,this.width,this.height,e,i,this.handleRadius,this.model.colors)}}dragSelectedHandles(t){const e=this.height/s.MAX_PITCH,i=(t.position.y-t.positionAtMouseDown.y)/e;for(const t of this.grid.selectedSet.getItems())t.velocity=t.initialVelocity-i,t.velocity=Math.min(s.MAX_PITCH,Math.max(1,t.velocity))}findHandleAt(t){let e=this.height/s.MAX_PITCH;for(const i of this.grid.notes){const s=this.grid.getPositionForTime(i.time),o=this.height-i.velocity*e;if(r.squaredDistance(t.x,t.y,s,o)<64)return i}return null}}e.VelocityTrack=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s extends HTMLElement{constructor(){super(...arguments),this.customColors=[]}static getCssName(t){return"--"+t.split(/(?=[A-Z])/).join("-").toLowerCase()}registerCustomColor(t,e){const i={name:t,cssName:s.getCssName(t),defaultValue:e,value:e};this.customColors.push(i)}styleChanged(){const t=window.getComputedStyle(this,null);this.customColors.forEach(e=>{e.value=t.getPropertyValue(e.cssName)||e.value})}}e.CustomElement=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(2),o=i(1);class n{constructor(){this.name="default",this.minSemitoneHeight=5}drawTimeBackground(t,e,i,o,n,r,l,h){const a=s.getBackgroundAlternateWidth(i,l);for(let s=0;s<Math.ceil(r);s+=o){const r=(s-n)*i;t.fillStyle=h.backgroundAlternate,s%(2*a)==0&&t.fillRect(r,0,a*i,e),r<0||(s%(16*l.upper/l.lower)==0?(t.fillStyle=h.strokeDark,t.fillRect(r,0,1,e)):0==Math.round(s%o)&&(t.fillStyle=h.strokeLight,t.fillRect(r,0,1,e)))}}drawNote(t,e,i,s,o,n,r,l){const h=Math.max(0,Math.min(4,.4*o,s)),a=Math.PI,d=Math.PI/2;t.beginPath(),t.arc(h+e,h+i,h,-d,a,!0),t.lineTo(e,i+o-h),t.arc(h+e,o-h+i,h,a,d,!0),t.lineTo(e+s-h,i+o),t.arc(e+s-h,i+o-h,h,d,0,!0),t.lineTo(e+s,i+h),t.arc(e+s-h,i+h,h,0,-d,!0),t.lineTo(e+h,i),t.fillStyle=l.noteHigh,t.fill(),t.globalAlpha=1-n/127,t.fillStyle=l.noteLowBlend,t.fill(),t.globalAlpha=1,o<4&&!r||(t.lineWidth=r?2:1,t.strokeStyle=r?l.noteOutlineSelected:l.noteOutline,t.stroke())}drawVelocityHandle(t,e,i,s,o,n,r,l,h){if(i.hidden)return;const a=Math.max(0,r*(i.tempDuration?i.tempDuration:i.duration)),d=o-i.velocity*n,c=i.selected?h.velocityHandleSelected:h.velocityHandle;t.fillStyle=c,t.fillRect(e,d-1,a,2),t.fillRect(e+a-1,d-3,2,6),t.fillStyle=h.background,t.strokeStyle=c,t.lineWidth=2,t.beginPath(),t.arc(e,d,l,0,2*Math.PI),t.fill(),t.stroke()}drawOctaveLines(t,e,i,s,n,r,l){t.fillStyle=l.strokeLight;for(let l=0;l<o.MAX_PITCH;l+=12)if(l>=s&&l<=n){const o=i-(l-s)*r;t.fillRect(0,o,e,1)}}drawSemiTonePattern(t,e,i,s,n,r,l){const h=(s-Math.floor(s))*r;for(let a=Math.floor(s);a<Math.ceil(n);++a){const n=a%12,d=h+(i-(a-Math.floor(s))*r)-r;t.fillStyle=l.backgroundBlackKey,o.PITCH_PATTERN[n]&&t.fillRect(0,d,e,r),t.fillStyle=l.strokeLight,t.fillRect(0,d,e,1)}}drawPitchRuler(t,e,i,s,o,n,r,l){this.isPianoRollVisible(n)&&(this.drawPianoRoll(t,e,i,s,o,n,l),t.fillStyle=l.strokeLight,t.fillRect(e/2,0,1,i)),this.drawPitchLabels(t,e,i,s,o,n,r,l)}drawPitchLabels(t,e,i,s,o,n,r,l){const h=this.isPianoRollVisible(n)?.25*e:.5*e;for(let r=0;r<128;r+=12)if(r+6>=s&&r<=o){const o=i-(r-s)*n,a=""+this.getOctaveNumber(r);t.fillStyle=l.text,t.font="11px Arial",t.textBaseline="middle",t.textAlign="center",t.fillText(a,h,o-6*n,e/2),t.fillStyle=l.strokeDark,t.fillRect(0,o,e,1)}}drawPianoRoll(t,e,i,s,n,r,l){for(let h=Math.floor(s);h<=Math.ceil(n);++h){const n=i-(h-s)*r,a=h%12,d=o.PITCH_PATTERN[a];t.fillStyle=t.fillStyle=d?l.blackKey:l.whiteKey,t.fillRect(e/2,n-r,e/2,r),t.fillStyle=l.strokeLight,t.fillRect(e/2,n-r,e/2,1)}}isOnPianoRoll(t,e,i,s,o){return this.isPianoRollVisible(o)&&t>i/2}isPianoRollVisible(t){return t>this.minSemitoneHeight}drawVelocityRuler(t,e,i,s){t.fillStyle=s.strokeDark,t.fillRect(e-1,0,1,i),t.fillRect(e-10,0,10,1),t.fillRect(e-10,Math.round(.5*i),10,1),t.fillRect(e-10,i-1,10,1),i>60&&(t.fillRect(e-5,Math.round(.25*i),5,1),t.fillRect(e-5,Math.round(.75*i),5,1)),t.fillStyle=s.text,t.fillText("0",e-20,i-2),t.fillText("100%",e-30,12)}getOctaveNumber(t){return Math.floor(t/12)-2}}e.LookAndFeel_Default=n;e.LookAndFeel_Live=class extends n{constructor(){super(...arguments),this.name="live"}drawNote(t,e,i,s,o,n,r,l){t.fillStyle=l.noteHigh,t.fillRect(e,i,s,o),t.globalAlpha=1-n/127,t.fillStyle=l.noteLowBlend,t.fillRect(e,i,s,o),t.globalAlpha=1,t.lineWidth=r?2:1,t.strokeStyle=r?l.noteOutlineSelected:l.noteOutline,t.strokeRect(e,i,s,o)}drawVelocityHandle(t,e,i,s,o,n,r,l,h){if(i.hidden)return;const a=i.velocity*n,d=o-a,c=i.selected?h.velocityHandleSelected:h.velocityHandle;t.fillStyle=c,t.fillRect(e-1,d,2,a),t.strokeStyle=c,t.fillStyle=h.background,t.lineWidth=1.8,t.beginPath(),t.arc(e,d,l,0,2*Math.PI),t.fill(),t.stroke()}drawPitchLabels(t,e,i,s,o,n,r,l){for(let r=0;r<128;r+=12)if(r>=s&&r<=o){const o=i-(r-s)*n,h="C"+(r/12-2);t.fillStyle=l.text,t.fillText(h,2,o-3,e/2),t.fillStyle=l.strokeDark,t.fillRect(0,o,e,1)}}drawVelocityRuler(t,e,i,s){t.fillStyle=s.strokeDark,t.textAlign="right",t.fillRect(e-1,0,1,i),t.fillRect(e-10,0,10,1),t.fillStyle=s.text,t.fillText("127",e-14,12),t.fillStyle=s.strokeDark,t.fillRect(e-5,Math.round(.5*i),5,1),t.fillRect(e-10,i-1,10,1),t.fillStyle=s.text,t.fillText("0",e-14,i-2)}}}]);
//# sourceMappingURL=note-sequencer.js.map